<!DOCTYPE html>
<html>

<head>
    <title>Test Supabase Connection</title>
    <style>
        body {
            font-family: Arial;
            padding: 20px;
        }

        .log {
            background: #f0f0f0;
            padding: 10px;
            margin: 5px 0;
            border-radius: 5px;
        }

        .error {
            background: #ffdddd;
        }

        .success {
            background: #ddffdd;
        }
    </style>
</head>

<body>
    <h1>ğŸ” Test de connexion Supabase</h1>
    <div id="logs"></div>

    <script type="module">
        const log = (msg, isError = false) => {
            const div = document.createElement('div');
            div.className = 'log ' + (isError ? 'error' : 'success');
            div.textContent = new Date().toLocaleTimeString() + ' - ' + msg;
            document.getElementById('logs').appendChild(div);
        };

        // Obtenir les variables d'environnement depuis le HTML
        const SUPABASE_URL = prompt("Entrez votre VITE_SUPABASE_URL:");
        const SUPABASE_KEY = prompt("Entrez votre VITE_SUPABASE_ANON_KEY:");

        if (!SUPABASE_URL || !SUPABASE_KEY) {
            log("âŒ Variables Supabase manquantes", true);
        } else {
            log("âœ… Variables trouvÃ©es");
            log("URL: " + SUPABASE_URL);

            // Test 1: Ping simple
            log("ğŸ”„ Test 1: Ping Supabase...");
            fetch(SUPABASE_URL + '/rest/v1/', {
                headers: {
                    'apikey': SUPABASE_KEY
                }
            })
                .then(r => r.text())
                .then(data => {
                    log("âœ… Supabase rÃ©pond!");
                })
                .catch(err => {
                    log("âŒ Erreur ping: " + err.message, true);
                });

            // Test 2: Charger les messages
            setTimeout(() => {
                log("ğŸ”„ Test 2: Chargement messages (avec LIMIT 10)...");
                const start = Date.now();

                fetch(SUPABASE_URL + '/rest/v1/messages?select=*&order=created_at.desc&limit=10', {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': 'Bearer ' + SUPABASE_KEY
                    }
                })
                    .then(r => r.json())
                    .then(data => {
                        const duration = Date.now() - start;
                        log(`âœ… Messages chargÃ©s: ${data.length} messages en ${duration}ms`);
                    })
                    .catch(err => {
                        const duration = Date.now() - start;
                        log(`âŒ Erreur messages aprÃ¨s ${duration}ms: ${err.message}`, true);
                    });
            }, 1000);

            // Test 3: Charger TOUS les messages (dangereux!)
            setTimeout(() => {
                log("ğŸ”„ Test 3: Chargement TOUS les messages (ATTENTION!)...");
                const start = Date.now();

                fetch(SUPABASE_URL + '/rest/v1/messages?select=*&order=created_at.asc', {
                    headers: {
                        'apikey': SUPABASE_KEY,
                        'Authorization': 'Bearer ' + SUPABASE_KEY
                    }
                })
                    .then(r => r.json())
                    .then(data => {
                        const duration = Date.now() - start;
                        log(`âœ… TOUS les messages: ${data.length} messages en ${duration}ms`);
                        if (duration > 3000) {
                            log(`âš ï¸ PROBLÃˆME DÃ‰TECTÃ‰: ${duration}ms c'est trop long! Vous avez ${data.length} messages.`, true);
                        }
                    })
                    .catch(err => {
                        const duration = Date.now() - start;
                        log(`âŒ Timeout ou erreur aprÃ¨s ${duration}ms: ${err.message}`, true);
                    });
            }, 3000);
        }
    </script>
</body>

</html>